namespace = action
# Recalculate strategic data for attack/defense ( chokepoints etc. )
country_event = {
	id = action.200
	hide_window = yes
	is_triggered_only = yes
	trigger = { exists = from }
	immediate = {
		set_update_modifiers_batch = begin
		from = { #So you don't have to survey a system you just lost again
			set_surveyed = {
				surveyor = root
				surveyed = yes
			}
		}
		run_ai_strategic_war_data = yes
		set_update_modifiers_batch = end
	}
}

event = {
	id = action.85
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_country = {
			any_owned_planet = {
				exists = starbase
				starbase = { owner = { NOR = { is_same_value = prevprevprev is_at_war_with = prevprevprev } } }
			}
			OR = { is_country_type = default is_fallen_empire = yes }
		}
	}

	immediate = {
		every_galaxy_planet = {
			limit = {
				exists = owner
				owner = {
					OR = {
						is_country_type = default
						is_fallen_empire = yes
					}
				}
				exists = starbase
				starbase = {
					exists = owner
					owner = {
						OR = {
							is_country_type = default
							is_fallen_empire = yes
						}
						NOR = {
							is_same_value = prevprev.owner
							is_at_war_with = prevprev.owner
						}
						NOT = {
							has_active_event = {
								primitive.180 #event to decide fate of primitive civ
							}
						}
					}
				}
			}
			planet_event = { id = action.86 } # planet flips to starbase owner
		}
	}
}

event = {
	id = action.90
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		any_playable_country = { any_owned_planet = {
			is_controlled_by = PREV
			solar_system = { NOT = { exists = starbase } }
		} }
		NOT = { any_country = { is_nivirana_battle_country = yes } }
	}
	immediate = {
		every_system = {
			limit = {
				NOT = { exists = starbase }
				any_system_colony = {
					exists = owner
					has_ground_combat = no
					owner = { OR = {
						is_country_type = default
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					} }
					solar_system = { NOR = {
						any_fleet_in_system = {
							exists = owner
							owner = {
								NOT = { is_same_value = prevprevprev.owner }
								OR = {
									is_hostile = prevprevprev.owner
									is_at_war_with = prevprevprev.owner
								}
							}
						}
						any_fleet_in_system = {
							exists = controller
							controller = {
								NOT = { is_same_value = prevprevprev.owner }
								OR = {
									is_hostile = prevprevprev.owner
									is_at_war_with = prevprevprev.owner
								}
							}
						}
						any_system_colony = {
							exists = owner
							NOT = { is_same_value = prevprev }
							owner = {
								NOT = { is_same_value = prevprevprev.owner }
								OR = {
									is_country_type = default
									is_country_type = fallen_empire
									is_country_type = awakened_fallen_empire
								}
							}
						}
					} }
				}
			}
			random_system_colony = {
				limit = {
					exists = owner
					has_ground_combat = no
					owner = { OR = {
						is_country_type = default
						is_country_type = fallen_empire
						is_country_type = awakened_fallen_empire
					} }
					solar_system = { NOR = {
						any_fleet_in_system = {
							exists = owner
							owner = {
								NOT = { is_same_value = prevprevprev.owner }
								OR = {
									is_hostile = prevprevprev.owner
									is_at_war_with = prevprevprev.owner
								}
							}
						}
						any_fleet_in_system = {
							exists = controller
							controller = {
								NOT = { is_same_value = prevprevprev.owner }
								OR = {
									is_hostile = prevprevprev.owner
									is_at_war_with = prevprevprev.owner
								}
							}
						}
						any_system_colony = {
							exists = owner
							owner = {
								NOT = { is_same_value = prevprevprev.owner }
								OR = {
									is_country_type = default
									is_country_type = fallen_empire
									is_country_type = awakened_fallen_empire
								}
							}
						}
					} }
				}
				planet_event = { id = action.91 }
			}
		}
	}
}


planet_event = {
	id = action.350
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = { is_ai = no }
	trigger = { owner = { is_ai = no } }

	immediate = {
		set_planetary_ascension_tier = 0
		set_timed_planet_flag = { flag = 3_year_owner_change_flag days = 1080 }
	}
}

# Land appropriation
planet_event = {
	id = action.42
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = { is_ai = no }
	trigger = { owner = { is_ai = no } }

	immediate = { add_modifier = { modifier = "land_appropriation" years = 5 } }
}

# Planet conquered
planet_event = {
	id = action.84
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = { is_ai = no }
	trigger = { owner = { is_ai = no } }

	immediate = { owner = { set_timed_country_flag = { flag = imperialist_conquest_timed_flag days = 3600 } } }
}

planet_event = {
	id = action.89
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			has_modifier = planet_population_control
			has_modifier = planet_growth_discouraged
			has_modifier = hunter_killer_drones
			has_modifier = compliance_protocols
			has_modifier = martial_law
			has_modifier = crime_lord_deal
			has_modifier = crime_lord_deal_broken
			has_modifier = anticrime_campaign
			has_modifier = penal_colony
			has_modifier = resort_colony
			has_modifier = slave_colony
			has_modifier = gang_wars
			has_modifier = drone_corruption
			has_modifier = drone_deviancy
			has_modifier = criminal_underworld
			has_modifier = center_of_drug_trade
			has_modifier = mob_rule
			has_modifier = crime_wave
			has_modifier = smuggler_activity
			has_modifier = substance_abuse
			has_modifier = bribed_officials
			has_modifier = cartel_war
			has_modifier = travel_advisory
			has_modifier = trade_pilfering
			has_modifier = protection_racket
			has_modifier = cartel_war
			has_modifier = ringleader_killed
			has_modifier = corrupt_network_terminated
			has_modifier = unemployment_benefits
			has_modifier = activity_program
			has_modifier = standby_mode
		}
	}

	immediate = {
		remove_modifier = planet_population_control
		remove_modifier = planet_growth_discouraged
		remove_modifier = hunter_killer_drones
		remove_modifier = compliance_protocols
		remove_modifier = martial_law
		remove_modifier = crime_lord_deal
		remove_modifier = crime_lord_deal_broken
		remove_modifier = anticrime_campaign
		remove_modifier = penal_colony
		remove_modifier = resort_colony
		remove_modifier = slave_colony
		remove_modifier = gang_wars
		remove_modifier = drone_corruption
		remove_modifier = drone_deviancy
		remove_modifier = criminal_underworld
		remove_modifier = center_of_drug_trade
		remove_modifier = mob_rule
		remove_modifier = crime_wave
		remove_modifier = smuggler_activity
		remove_modifier = substance_abuse
		remove_modifier = bribed_officials
		remove_modifier = cartel_war
		remove_modifier = travel_advisory
		remove_modifier = trade_pilfering
		remove_modifier = protection_racket
		remove_modifier = cartel_war
		remove_modifier = ringleader_killed
		remove_modifier = corrupt_network_terminated
		remove_modifier = unemployment_benefits
		remove_modifier = activity_program
		remove_modifier = standby_mode
	}
}